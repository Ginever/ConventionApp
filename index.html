<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link rel="stylesheet" href="main.css">

    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.13.2/firebase-database.js"></script>
</head>
  <body>
    <h1>Convention Sign Up</h1>

    <div class="flex-container-horizontal">
        <label class="small-text-label" for="username">User Name:</label>
        <input type="text" id="username" name="username">
    </div>

    <div class="flex-container-horizontal">
        <label class="small-text-label hidden" for="password">Password:</label>
        <input type="password" id="password" name="password">
    </div>

    <div class="flex-container-horizontal">
        <button type="button" class="sign-up-btn">Sign Up</button>
        <button type="button" class="log-in-btn">Log In</button>
    </div>

    <div class="flex-container-horizontal">
        <label class="small-text-label" for="full-name">Full Name:</label>
        <input type="text" id="full-name" name="full-name">
    </div>

    <div class="flex-container-horizontal">
    <label for="convention-attending" class="small-text-label">Which Convention are you attending:</label>
    <select name="convention-attending" id="convention-attending">
        <option value="1st Pukekohe">1st Pukekohe</option>
        <option value="2nd Pukekohe">2nd Pukekohe</option>
        <option value="Ngaere">Ngaere</option>
        <option value="1st Masterton">1st Masterton</option>
    </select>
    </div>

    <div class="flex-container-horizontal">
      <button type="button" class="enter-btn">Enter</button>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
      import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"; 
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyCRGO1PR6dGLQeac-jTOtrvJ6pu0pxJ35Y",
        authDomain: "conventionapp-b0c29.firebaseapp.com",
        projectId: "conventionapp-b0c29",
        storageBucket: "conventionapp-b0c29.appspot.com",
        messagingSenderId: "98324564320",
        appId: "1:98324564320:web:5d666e37ed9c3fd6393605",
        databaseURL: "https://conventionapp-b0c29-default-rtdb.nam5.firebaseio.com/"
      };

  // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();

    var user = null;

    function logInUser(email, password){
        signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            // Signed in 
            user = userCredential.user;
            console.log(user);
            // ...
        })
        .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
        });
    }

    function createUser(email, password) {
        createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            // Signed up 
            user = userCredential.user;
            // ...
        })
        .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            // ..
        });
    }

    function autoLogIn(){
      signInWithEmailAndPassword(auth, "zacginever@outlook.com", "testing")
        .then((userCredential) => {
            // Signed in 
            user = userCredential.user;
            console.log(user);
            // ...
        })
        .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
        });
    }
    
    function writeUserData(name, convention, email){
      const db = getDatabase();
    	set(ref(db, 'users/' + user.uid), {
        name: name,
        convention: convention,
        email: email
      });
      console.log("hello");
    }

    autoLogIn();

    //Password and username sign in
    var username = document.getElementById("username");
    var password = document.getElementById("password");
    document.querySelector('.sign-up-btn').addEventListener('click', function() {createUser(username.value, password.value)});
    document.querySelector('.log-in-btn').addEventListener('click', function() {logInUser(username.value, password.value)});
    document.querySelector('.enter-btn').addEventListener('click', function() {writeUserData("Zac Ginever", "sdfifsd", "dfskj")});
    </script>
  </body>
</html>